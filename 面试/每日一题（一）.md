1.  **MYSQL为什么用B+树做索引结构？平时过程中怎么加的索引？（腾讯）** 

   >  因为4.0成型那个年代，B树体系大量用于文件存储系统，甚至当年的Longhorn的winFS都是基于b树做索引，开源而且好用的也就这么个体系了。B+树的磁盘读写代价更低,便于遍历,查询效率更加稳定,更适合基于范围的查询。数据来了先用索引节点找叶子，叶子找不到就新建叶子加索引书，这样减少io重复劳动。
   >
   > B树为平衡二叉树一种 分为B+树和B—树其中B+树在树内节点不存储数据只存key B-树将key和value一同存储在各子节点
   > 这样保证了树的每个节点只有一次IO
   > 在一般实际应用中树的出度是一个非常大的值 因此树的深度一般不会3层，因此B树的数据类型检索数据的效率是非常快的
   > 这样一来决定性能的取决于内节点和出度存储上限
   > 由于B+树的存储特点决定B+树的检索效率优于B—数 因此采用B+数作为数据索引最优 

2.  **分库分表后如何迁移？（腾讯）**  

   >  停机迁移、双写迁移。 

3.  **es底层读写原理？倒排索引原理?（腾讯）**

   >  **es写数据过程**
   > 1、客户端选择一个node发送请求过去，这个node就是coordinating node（协调节点）
   > 2、coordinating node 对document进行路由，将请求转发给对应的node（有primary shard）
   > 3、实际的node上的primary shard 处理请求，然后将数据同步到replica node。
   > 4、coordinating node如果发现 primary node和所有replica node都搞定之后，就返回响应结果给客户端。
   >
   > **es读数据过程**
   > 可以通过doc id 来查询，会根据doc id进行hash，判断出来当时把doc id分配到了哪个shard上面去，从那个shard去查询。
   > 1、客户端发送请求到任意一个node，成为coordinate node
   > 2、coordinate node 对doc id进行哈希路由，将请求转发到对应node，此时会使用round-robin随机轮询算法，在primary shard 以及其所有replica中随机选择一个，让读请求负载均衡。
   > 3、接收请求的node返回document给coordinate node。
   > 4、coordinate node返回document给客户端。
   >
   > **倒排原理**：关键词分词 

4.   **redis 10G 内存开一个实例 和redis 1G内存开10个实例有什么区别（腾讯）** 

   >  开10个实例相对更占资源，在多核下能充分利用资源。 

5. **接口如何防重放和被篡改？（腾讯）** 

   > 防重放：幂等性，url里添加唯一标识参数
   > 防篡改：url里添加签名参数 

6.  **如何对数据库进行垂直拆分或水平拆分的？（字节跳动）**

   >  丨 ->垂直
   >  —   ->水平
   >
   > 分库分表方案如下：
   > merge存储引擎
   > amoeba
   > MySQL Proxy
   > mycat
   > CobarClient
   > HibernateShard
   > guzz
   > TDDL
   >  Atlas
   > DRDS 

7. **什么是幂等性？（字节跳动）** 

   >  调用一次和多次，对资源产生影响是相同的。 

8. **柔性事务是什么，分布式环境下为何要放弃传统事务？（字节跳动）** 

   >  XA协议能搞定两个数据库的事务（分布式标准事务），为什么还要放弃？1.性能低，2.A的api不希望直接用B的数据库，希望调用B的api。
   > 柔性事务放弃了ACID，只保证了一致性。 
   > 常用柔性事务框架：seata框架，lcn框架。 

9. **实现分布式Session的过程是怎样的？（字节跳动）** 

   >  分布式session ，最开始起源是双机热备，当时php1和php2为了共享session，一开始采用samba/nfs,后来php有了插件以后就扔当时刚刚起步的mdb/redis ， 后来java出现了jwt令牌机制，再到后来越发成熟的Oauth2机制，反正我们这边程序员要求是已经放弃了数据塞session的习惯了。明明有更快的redis直写直读，为什么要绕呢…
   >

10.  **对Java接口代理模式的实现原理的理解?（字节跳动）** 

    > 

11. **如何实现分布式锁（字节跳动三面）** 

     ![img](E:\github项目\java-dance\面试\imgs\HK55LOXO`8Q7MPI0K3SQ$@Q.png) 

12. **如何保证redis和mysql数据一致？（字节跳动三面）** 

     见图![image-20200523210455512](E:\github项目\java-dance\面试\imgs\image-20200523210455512.png)

13. **如何解决缓存击穿问题？（字节跳动三面）** 

    >  通过加锁解决缓存击穿问题。布隆过滤器是解决缓存穿透问题的。 

14. **如何实现并发限流（字节跳动3面）** 

    > 计数器、漏桶、令牌桶。
    >
    > 除了算法手动实现限流 guava也有提供限流工具 除了程序内限流 gateway 网关nginx也能实现限流。
    >
    > 短连接无状态的的集群并发接口的限流 只能靠 7层负载均衡器上的网关功能。
    > 长连接或者说有状态的接口 限流 依靠 类分布式锁 准分布式锁。 

15.  **ZK分布式锁有几种实现方式？各自的优缺点是什么？（字节跳动3面最后一题）** 